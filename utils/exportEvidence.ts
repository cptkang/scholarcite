
import { SavedCitation } from "../types";

/**
 * ëª¨ë“  ì¸ìš© ì¦ê±° ìë£Œë¥¼ Markdown í˜•ì‹ìœ¼ë¡œ ë³€í™˜
 */
export function generateEvidenceMD(savedCitations: SavedCitation[]): string {
  let md = `# Academic Evidence Inventory\n\n`;
  md += `*Generated by ScholarCite AI*\n`;
  md += `*Total Sessions: ${savedCitations.length}*\n\n---\n\n`;

  savedCitations.forEach((cit, cIdx) => {
    md += `## Session ${savedCitations.length - cIdx} (${new Date(cit.timestamp).toLocaleString()})\n\n`;
    
    cit.references.forEach((ref) => {
      md += `### [REF #${ref.id}] ${ref.title}\n`;
      md += `- **Authors**: ${ref.authors}\n`;
      md += `- **Year**: ${ref.year}\n`;
      md += `- **Journal**: ${ref.journal} [${ref.grade}]\n`;
      md += `- **Source URL**: ${ref.url}\n`;
      md += `- **Location in Paper**: ${ref.sourceSection || 'UNKNOWN'}\n\n`;
      
      md += `#### âœ¨ ë‚´ ë¬¸ì„œì— ìƒì„±ëœ ë¬¸ì¥ (Your Result Sentence)\n`;
      md += `> ${ref.relatedCitedSentence || 'ì •ë³´ ì—†ìŒ'}\n\n`;

      md += `#### ğŸ“‹ ì¶”ì¶œëœ ë…¼ë¬¸ ì›ë¬¸ (Evidence Sentence)\n`;
      md += `> ${ref.originalSourceSentence || 'ì •ë³´ ì—†ìŒ'}\n\n`;
      
      md += `#### ğŸ” ì›ë¬¸ ë‹¨ë½ ë¬¸ë§¥ (Context)\n`;
      md += `\`\`\`text\n${ref.sourceParagraph || 'ì •ë³´ ì—†ìŒ'}\n\`\`\`\n\n`;
      
      md += `#### ğŸ’¡ ì¸ìš© íƒ€ë‹¹ì„± (Logical Linkage)\n`;
      md += `${ref.citationReason}\n\n`;
      md += `---\n\n`;
    });
  });

  return md;
}

/**
 * ëª¨ë“  ì¸ìš© ì¦ê±° ìë£Œë¥¼ Word í˜¸í™˜ HTML(.doc) í˜•ì‹ìœ¼ë¡œ ë³€í™˜
 */
export function generateEvidenceDoc(savedCitations: SavedCitation[]): string {
  let html = `
    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
    <head><meta charset='utf-8'><title>Evidence Inventory</title>
    <style>
      body { font-family: 'Malgun Gothic', sans-serif; line-height: 1.6; }
      h1 { color: #1e293b; border-bottom: 2px solid #334155; padding-bottom: 10px; }
      h2 { color: #4338ca; margin-top: 30px; border-left: 5px solid #4338ca; padding-left: 10px; }
      h3 { color: #0f172a; margin-top: 20px; background: #f1f5f9; padding: 5px 10px; }
      .label { font-weight: bold; color: #64748b; font-size: 0.9em; text-transform: uppercase; margin-top: 15px; }
      .result-box { background: #ecfdf5; border: 1px solid #10b981; padding: 15px; margin: 10px 0; }
      .evidence-box { background: #eef2ff; border: 1px solid #4338ca; padding: 15px; margin: 10px 0; font-style: italic; }
      .context-box { background: #fff; border: 1px dotted #cbd5e1; padding: 15px; font-size: 0.85em; color: #475569; }
      .reason { color: #059669; font-weight: 500; }
      .section-badge { background: #334155; color: white; padding: 2px 8px; font-size: 0.8em; border-radius: 4px; }
    </style>
    </head>
    <body>
    <h1>Academic Evidence Inventory</h1>
    <p>Generated by ScholarCite AI Platinum - Total Evidence Summary</p>
  `;

  savedCitations.forEach((cit, cIdx) => {
    html += `<h2>Session ${savedCitations.length - cIdx} - ${new Date(cit.timestamp).toLocaleString()}</h2>`;
    
    cit.references.forEach((ref) => {
      html += `<h3>[REF #${ref.id}] ${ref.title} <span class='section-badge'>${ref.sourceSection}</span></h3>`;
      html += `<p><strong>Authors:</strong> ${ref.authors} (${ref.year})<br/>`;
      html += `<strong>Journal:</strong> ${ref.journal} [${ref.grade}]<br/>`;
      html += `<strong>URL:</strong> <a href='${ref.url}'>${ref.url}</a></p>`;
      
      html += `<p class='label'>ë‚´ ë¬¸ì„œì— ìƒì„±ëœ ë¬¸ì¥</p>`;
      html += `<div class='result-box'>${ref.relatedCitedSentence || 'ì •ë³´ ì—†ìŒ'}</div>`;

      html += `<p class='label'>ë…¼ë¬¸ ë‚´ ì‹¤ì œ ì›ë¬¸ ë¬¸ì¥</p>`;
      html += `<div class='evidence-box'>"${ref.originalSourceSentence || 'ì •ë³´ ì—†ìŒ'}"</div>`;
      
      html += `<p class='label'>ë‹¨ë½ ë¬¸ë§¥</p>`;
      html += `<div class='context-box'>${ref.sourceParagraph || 'ì •ë³´ ì—†ìŒ'}</div>`;
      
      html += `<p class='label'>ì¸ìš© íƒ€ë‹¹ì„± ë…¼ë¦¬</p>`;
      html += `<p class='reason'>${ref.citationReason}</p>`;
      html += `<hr style='border: 0; border-top: 1px solid #eee;'/>`;
    });
  });

  html += `</body></html>`;
  return html;
}
